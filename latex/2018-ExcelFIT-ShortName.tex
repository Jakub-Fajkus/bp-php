\documentclass{ExcelAtFIT}
\usepackage[T1]{fontenc}
%\documentclass[czech]{ExcelAtFIT} % when writing in CZECH
%\documentclass[slovak]{ExcelAtFIT} % when writing in SLOVAK

%\todo{opravit citaci pro [3]}

%--------------------------------------------------------
%--------------------------------------------------------
%	REVIEW vs. FINAL VERSION
%--------------------------------------------------------

%   LEAVE this line commented out for the REVIEW VERSIONS
%   UNCOMMENT this line to get the FINAL VERSION
%\ExcelFinalCopy


%--------------------------------------------------------
%--------------------------------------------------------
%	PDF CUSTOMIZATION
%--------------------------------------------------------

\hypersetup{
	pdftitle={Evolution of programs controlling simple robot model},
	pdfauthor={Jakub Fajkus},
	pdfkeywords={Evolutionary computation, Linear Genetic Programming, Robotics}
}

%--------------------------------------------------------
%--------------------------------------------------------
%	ARTICLE INFORMATION
%--------------------------------------------------------

\ExcelYear{2018}

\PaperTitle{Evolution of programs controlling simple robot model}

\Authors{Jakub Fajkus*}
\affiliation{*%
  \href{mailto:xfajku06@stud.fit.vutbr.cz}{xfajku06@stud.fit.vutbr.cz},
  \textit{Faculty of Information Technology, Brno University of Technology}}

\Keywords{Evolutionary computation  --- Linear Genetic Programming --- Robotics}

\Supplementary{\href{http://youtu.be/S3msCdn3fNM}{Demonstration Video} --- \href{http://excel.fit.vutbr.cz/}{Downloadable Code}}


%--------------------------------------------------------
%--------------------------------------------------------
%	ABSTRACT and TEASER
%--------------------------------------------------------

\Abstract{
The aim of this work to utilize Evolutionary Algorithms for finding a computer program that will control a simple robot model.
The model is placed in the physical simulation where it is supposed to move to specified reference points.
The program that controls the model is based on instructions and is inspired by Linear Genetic Programming.
The program has an information about a direction to the next reference point.
}

\Teaser{
	\TeaserImage{placeholder.pdf}
	\TeaserImage{placeholder.pdf}
	\TeaserImage{placeholder.pdf}
}



%--------------------------------------------------------
%--------------------------------------------------------
%--------------------------------------------------------
%--------------------------------------------------------
\begin{document}

\startdocument


%--------------------------------------------------------
%--------------------------------------------------------
%	ARTICLE CONTENTS
%--------------------------------------------------------

%--------------------------------------------------------
%--------------------------------------------------------
%--------------------------------------------------------
%--------------------------------------------------------
\section{Introduction}
In the area of robotics it is very important to be able to create prototypes fast and cheap.
For this purpose it is beneficial to use computer models and simulation when designing the physical aspect of the robot.
There is many ways to control the robot depending on the requirements we have.
It can be for example controlled by instructions of a imperative language~\cite{Wolff2007}, finite state machines~\cite{Hodgins1996}, classical control theory~\cite{Mita1984} or artificial neural networks~\cite{Reil2002}~\cite{Lewis1996}.
For fast prototyping we can use Evolutionary Algorithms to evolve the robot control.

%V oblasti robotiky je velmi dulezita schopnost rychle a levne prototypovat mozna reseni.
%K tomuto ucelu je velmi vhodne pouziti pocitacove modelovani a simulace.
%PRIDAT? V situaci, kdy mame navrzenou fyzickou stranku robota, nastava otazka, jak rychle prototypovat jeho rizeni.
%Existuje mnoho moznosti realizace rizeni robota, lisici se v zavislosti na pozadavcich a povaze cinosti robota.
%Rizeni robota muze byt zalozeno na instrukcich nejakeho imperativniho jazyka nebo na neuronovych sitich.
%Dalsi z moznosti jsou ruzne planovaci algoritmy a systemy. \todo{citace, zdroje, terminologie}
%Pro prototypovani je vyhodne mit nastroj, ktery je schopny hledat vyhodne zpusoby rizeni robota.
%Evolutionary algorithms are good for this purpose, because they are applicable for a wide range of problems.

The problem to solve is defined as follows.
We have a model of a simple robot and we want to evolve a program that is based on instructions of an imperative language.
The robot is supposed to move in the simulated environment and visit the predefined reference points.
This way we can define a trajectory that the robot should follow.
The program that controls the model is being evolved using Evolutionary Algorithms and then evaluated in the Mujoco simulator~\cite{Todorov2012}.

%Hledame reseni pro problem, ktery je definovan takto.
%Mame model jednoducheho robota, pro ktereho hledame model rizeni.
%Cilem je nalezt program(posloupnost instrukci) ktery bude model robota ritit tak, ze bude vykonavat pohyb po dane trajektorii..
%Hledani reseni probiha automatizovane s vyuzitim evolucnich algoritmu.
%K vyhodnoceni uspesnosti reseni je pouzit fyzikalni simulator specializovany na simulaci robotu Mujoco~\cite{Todorov2012}.

There are many works focused on evolutionary robotics.
The ones that were focusing robot control used techniques including finite state machines~\cite{Hodgins1996}, classical control theory~\cite{Mita1984} and artificial neural networks~\cite{Reil2002}~\cite{Lewis1996}.
There is also a number of works using Evolutionary Algorithms to evolve controllers, particularly artificial neural networks~\cite{Randall1992}~\cite{Farooq2013}.
There are also works that are using Genetic Programming~\cite{Macedo2017}.
The most similar work to to this one is the work of Wollf and Mattias~\cite{Wolff2007}.
They are using Linear Genetic Programming to evolve a bipedal locomotion of a humanoid model.

The work of Wollf and Mattias uses Linear Genetic Programming with various arithmetic instructions and branching.
The instruction set in this work is reduced to only one instruction and only natural numbers ranging from -5 to 5 are used for possible values.
The program in this work is split into smaller subprograms, as opposed to one program.
Both the works use some sort of a environmental awareness.
This work implements that by introducing an event subprogram as well as an information about direction to the next reference point.
The subprogram is executed when an event occurs in the environment(coming closer to a reference point).
Wollf and Mattias used a set of sensors, that are measuring current joint angles of the model.

As results of the experiments the programs exhibited the behaviour that was expected.
Additionally, a few best solutions were evaluated for a different trajectory and they exhibited tendency to move along them.

%--------------------------------------------------------
%--------------------------------------------------------
%--------------------------------------------------------
%--------------------------------------------------------
\section{Theoretical background}
\label{sec:theory}
Here we will discuss a brief introduction to Linear Genetic Programming, based on~\cite{Brameier2010}.
LGP is a special variant of the Genetic Programming.

Genetic Programming (GP) solves a modelling problem.
That means we know a set of inputs to a system and the outputs it should produce.
But we do not have the system that will compute the inputs and tell us the output.
When solving a control problem, we are looking for a such function, that will lead to the desired behavior.

In GP we are evolving computer program $P$ that represents a function: $f : I^n \to O^m$, where $I^n$ denotes the input data of $n$ dimensions and $O^m$ denotes the output data in $m$ dimensions.

The genotype space $G$ in GP includes all programs that can be composed of elements of a programming language $L$.
Programming language $L$ is defined by a instruction set and a terminal set.
An interpreter translates the genotype representation into the phenotype.
The phenotype is then executed and it's fitness is measured.

The original GP uses trees that correspond to expressions from a functional programming language.
The nodes of the tree represent functions, while leaves represent input values or constants.

The Linear Genetic Programming is a variant where programs are composed of a list of instructions from an imperative language or a machine code.
Each program has available predefined set of registers that can hold constants as well as results of instructions.
Those registers are often divided into groups: input registers, output registers and calculation registers.
The instructions are composed of an operation and one or more operands.
The operands may be registers or constants.
As the program is being executed it modifies the values of the registers, reads the inputs and writes the outputs.

%--------------------------------------------------------
%--------------------------------------------------------
%--------------------------------------------------------
%--------------------------------------------------------

\section{Experiments setup}
\label{sec:ExperimentsSetup}
There is a prepared scene in the simulator containing a set of reference points placed on a spiral(Figure~\ref{fig:SpiralTop}).
The robot model is given a task to move from point to point at given order and to get as close as possible to each of them.
This way the robot moves on a predefined trajectory.

%todo: image placement
%todo: change the image to containt he 3 leg thingy and where the reference points are not all over the place
\begin{figure}[t]
\centering
{\includegraphics[height=19em]{spiral_top_v2.png}}
\caption{Top view at the scene in the simulator.
We can see a spiral on which are placed the reference points(yellow spheres).
The robot's model is brown.
The robot's task is to navigate through the scene and get as close as possible to each one of the reference points.}
\label{fig:SpiralTop}
\end{figure}


\subsection{Robot control}
The robot is controlled by a program that is composed of instructions.
The simulator contains an interpret which executes the instructions and controls the robot actuated joints(Figure~\ref{fig:Interpret}).

%todo: image placement
\begin{figure}[t]
	\centering
	{\includegraphics[width=20em]{interpret.png}}
	\caption{
	Schematic view of the interpret.
	The only instruction type is the SRE instruction.
	The first argument is a input register index and the second is the output register index.
	The interpret has 11 constant registers(indices 0--10), 2 input registers(indices 11--12) and 3 output registers(indices 13--15).
	The input registers values depend on the direction to the next reference point(Figure~\ref{fig:ReferenceDirection}).
	Every 0.3 seconds a instruction is fetched and its arguments are used as register indices.
	A value from constant or input register is then copied into the output register.
	The situation depicted there is as follows.
	The instructions is fetched with values of 11 and 14.
	A value from input register with index 11 is copied into the output register with index 14.
	}
	\label{fig:Interpret}
\end{figure}

The interpret works only with natural numbers ranging from -5 to 5.
It contains predefined set of registers.
There are 11 immutable constant registers containing all possible constants(-5 to 5).
Next, there are two immutable input registers containing information about the direction to the next reference point(Figure~\ref{fig:ReferenceDirection}).
One of them contains the opposite value of the other.

%todo: image placement
\begin{figure}[t]
	\centering
	{\includegraphics[width=18em]{reference_direction_angles.png}}
	\caption{
		The angle between the robot's heading vector(red arrow) and the vector to the next reference point(green arrow) is mapped to interpret inputs(-5 to 5).
		The reference point showed there(blue circle) would result in input value of 2 in one input register and -2 in the other input register.
	}
	\label{fig:ReferenceDirection}
\end{figure}

There are write only registers, each of them is directly mapped to one of the robot's joints.
The value in the output register is then converted into a force applied at the joint.

There is only one type of instruction.
This instruction copies a value from the input or constant register into the output register.
The instruction is composed of two values.
The first is the identification of the input or constant register.
The other is the identification of the output register.

The program itself is split into 3 smaller subprograms - init, event and main.
The init subprogram is executed at the start of the simulation and its purpose is to set the initial "pose" of the robot.
All instructions of the init program are executed in a single time.
After that there is a small, one second waiting time to give the robot time to establish the "pose".

The event subprogram is run each time the robot gets close enough to some of the reference points(but only once for each point).
It's purpose is to change the robot's "pose" as a preparation to move to the next reference point.
The event subprogram is executed in a single time and the waiting time is used as well as in the init subprogram.

The main subprogram is being run in an endless loop during the simulation.
Only one instruction is executed at a time.
Period of 0.3 seconds is used.


%--------------------------------------------------------
%--------------------------------------------------------
%--------------------------------------------------------
%--------------------------------------------------------
\subsection{EA instance}
\label{sec:Experiment}
Here we will describe the instance of Evolutionary Algorithm used.
%todo keep the list in one column
\begin{itemize}
	\item Population size is set to 1000
	\item Steady-state population model is used(the better half of the population is kept, the other one replaced).
	\item The genotype length is fixed to 36 instructions.
	\item A custom genetic crossover based on uniform crossover is used(Figure~\ref{fig:Crossover}).
	\item The probability of crossover is 80\%.
	\item The mutation is set with 100\% probability and changes only one gene.
	\item Parent selection is implemented by tournament of size 2.
\end{itemize}

%todo: image placement
\begin{figure}[t]
	\centering
	{\includegraphics[width=18em]{crossover.png}}
	\caption{
	A custom genetic crossover is used.
	It is based on uniform crossover, but it operates on the subprograms level.
	The genome of parents is divided into the subprograms and then there is a 1:1 chance to to inherit the subprogram from parent A or B.
	Here, the crossover of parents A and B resulted into offsprings C and D.
	In this case, only the init subprograms were swapped.
	}
	\label{fig:Crossover}
\end{figure}



%--------------------------------------------------------
%--------------------------------------------------------
%--------------------------------------------------------
%--------------------------------------------------------

\section{Results}
The evolution was run 20 times.
The typical progress of fitness values can be seen in Figure~\ref{fig:FitnessGraph}.
The maximum fitness possible in the given amount of time is around 280 and the best solution found had 255.9.

Some of the best results were evaluated for a different trajectories(Figure~\ref{fig:PostExperimentTests}), however the behaviour was not satisfying.
They definitely exhibited some degree of movement towards the reference points, but the locomotion pattern encoded in the program was not flexible enough to cope with different environment.
This is mainly because the locomotion pattern is expressed as a list of hardcoded instructions with constant values.
So, if the training environment had the reference points placed on a spiral, the program itself is evolved to move generally in a spiral.

If a different approach was used, for example using more input values coming either from oscillators with different frequencies or some sensory information(rotation of joints), the programs could then evolve a universal locomotion pattern that would be only adjusted with the information about direction to the next reference point.

%todo: image placement
\begin{figure}[t]
	\centering
	{\includegraphics[height=17em]{runFitnessGraph.png}}
	\caption{
	A typical progress of fitness values in a evolutionary run.
	}
	\label{fig:FitnessGraph}
\end{figure}

%todo: image placement
\begin{figure}[t]
	\centering
	{\includegraphics[height=16em]{postExperimentTests.png}}
	\caption{
	Trajectories used to evaluate the ability of the found solutions to navigate in unknown conditions.
	}
	\label{fig:PostExperimentTests}
\end{figure}

%--------------------------------------------------------
%--------------------------------------------------------
%--------------------------------------------------------
%--------------------------------------------------------

\section{Conclusions}
\label{sec:Conclusions}

%\textbf{[Paper Summary]} What was the paper about, then? What the reader needs to remember about it?
This work showed an usage of Evolutionary Algorithms for finding a program for a robot control.
The results show that the programs evolved successfully to meet the given criteria, although failed to adapt to a new behaviour.
However, the original question behind this work was that whether a very simple program could control the robot in a way that it will move on a non trivial trajectory.

Providing the program with more sensory information as well as some oscillators could lead to better universality.
This thought will be put under test in the future experiments.

%\textbf{[Highlights of Results]} Exact numbers. Remind the reader that the paper matters.
%\phony{Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed tempus fermentum ipsum at venenatis. Curabitur ultricies, mauris eu ullamcorper mattis, ligula purus dapibus mi, vel dapibus odio nulla et ex. Sed viverra cursus mattis. Suspendisse ornare semper condimentum. Interdum et malesuada fames ac ante ipsum.}
%
%\textbf{[Paper Contributions]} What is the original contribution of this work? Two or three thoughts that one should definitely take home.
%\phony{Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent posuere mattis ante at imperdiet. Cras id tincidunt purus. Aliquam erat volutpat. Morbi non gravida nisi, non iaculis tortor. Quisque at fringilla neque.}
%
%\textbf{[Future Work]} How can other researchers / developers make use of the results of this work?  Do you have further plans with this work? Or anybody else?
%\phony{Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse sollicitudin posuere massa, non convallis purus ultricies sit amet. Duis at nisl tincidunt, maximus risus a, aliquet massa. Vestibulum libero odio, condimentum ut ex non, eleifend.}

%todo: podekovani!
%\section*{Acknowledgements}
%I would like to thank my supervisor X. Y. for his help.

%--------------------------------------------------------
%--------------------------------------------------------
%--------------------------------------------------------
%	REFERENCE LIST
%--------------------------------------------------------
%--------------------------------------------------------
\phantomsection
\bibliographystyle{unsrt}
\bibliography{2018-ExcelFIT-ShortName-bib}

%--------------------------------------------------------
%--------------------------------------------------------
%--------------------------------------------------------
\end{document}
